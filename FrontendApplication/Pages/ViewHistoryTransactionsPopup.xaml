<?xml version="1.0" encoding="utf-8" ?>
<popup:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:popup="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="FrontendApplication.Popups.ViewTransactionsPopup">

    <Frame BackgroundColor="#1C1C1C"
           CornerRadius="25"
           Padding="20"
           WidthRequest="380"
           HeightRequest="600"
           VerticalOptions="Center"
           HorizontalOptions="Center"
           HasShadow="True">

        <Grid RowDefinitions="*, Auto">
            <!-- Scrollable Content -->
            <ScrollView Grid.Row="0">
                <VerticalStackLayout Padding="20"
                        Spacing="15">

                    <!-- Title -->
                    <Label Text="Transaction History"
                           FontAttributes="Bold"
                           FontSize="22"
                           TextColor="White"
                           HorizontalOptions="Center"/>

                    <!-- Filter Type Picker -->
                    <Picker x:Name="FilterTypePicker"
                            Title="Select Filter Type"
                            SelectedIndexChanged="OnFilterTypeChanged"
                            TextColor="White"
                            BackgroundColor="#2A2A2A"
                            FontSize="14"
                            HeightRequest="40">
                        <Picker.Items>
                            <x:String>Category</x:String>
                            <x:String>Date Range</x:String>
                        </Picker.Items>
                    </Picker>

                    <!-- Category Filter Section -->
                    <VerticalStackLayout x:Name="CategoryFilterSection"
                            IsVisible="False">
                        <Picker x:Name="CategoryPicker"
                                Title="Filter by Category"
                                SelectedIndexChanged="OnCategorySelected"
                                ItemsSource="{Binding AvailableCategories}"
                                TextColor="White"
                                BackgroundColor="#2A2A2A"
                                FontSize="14"
                                HeightRequest="40"/>
                    </VerticalStackLayout>

                    <!-- Date Filter Section -->
                    <VerticalStackLayout x:Name="DateFilterSection"
                            IsVisible="False"
                            Spacing="10">
                        <Label Text="Filter by Date Range"
                               FontAttributes="Bold"
                               TextColor="White"
                               FontSize="14"/>

                        <HorizontalStackLayout Spacing="15">
                            <VerticalStackLayout>
                                <Label Text="From:"
                                        TextColor="White"
                                        FontSize="13"/>
                                <DatePicker x:Name="StartDatePicker"
                                            TextColor="White"
                                            BackgroundColor="#2A2A2A"
                                            HeightRequest="40"/>
                            </VerticalStackLayout>

                            <VerticalStackLayout>
                                <Label Text="To:"
                                        TextColor="White"
                                        FontSize="13"/>
                                <DatePicker x:Name="EndDatePicker"
                                            TextColor="White"
                                            BackgroundColor="#2A2A2A"
                                            HeightRequest="40"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <Button Text="Apply Date Filter"
                                Clicked="OnApplyDateFilterClicked"
                                BackgroundColor="#356c67"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="45"/>
                    </VerticalStackLayout>

                    <!-- Transaction List -->
                    <CollectionView x:Name="TransactionList"
                                    ItemsSource="{Binding Transactions}"
                                    EmptyView="No transactions found.">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#1E1E1E"
                                       CornerRadius="10"
                                       Padding="10"
                                       Margin="0,5,0,5"
                                       HasShadow="True">
                                    <VerticalStackLayout>
                                        <Label Text="{Binding Category.Name}"
                                               FontAttributes="Bold"
                                               FontSize="16"
                                               TextColor="White"/>
                                        <Label Text="{Binding Description}"
                                               FontSize="13"
                                               TextColor="LightGray"/>
                                        <Label Text="{Binding Period}"
                                               FontSize="13"
                                               TextColor="LightGray"/>
                                        <Label Text="{Binding Amount, StringFormat='{0:N2} NIS'}"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="LimeGreen"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </ScrollView>

            <!-- Close Button at the Bottom -->
            <Button Grid.Row="1"
                    Text="CLOSE"
                    Command="{Binding CloseCommand}"
                    BackgroundColor="Grey"
                    TextColor="White"
                    CornerRadius="25"
                    FontSize="18"
                    FontAttributes="Bold"
                    HorizontalOptions="Center"
                    WidthRequest="200"
                    HeightRequest="50"
                    Margin="0,15,0,0"/>
        </Grid>
    </Frame>
</popup:Popup>
